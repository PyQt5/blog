{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"qwebengineview\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/qtwebjs.html",
            "url": "https://pyqt5.com/qtwebjs.html",
            "title": "QtWebkit和QWebEngineView与Javascript交互",
            "date_published": "2019-05-22T03:30:36.000Z",
            "content_html": "<p>以前还是 <code>QWebView</code>  的时候和 <code>Javascript</code>  交互起来很方便，但是到了 Qt5.6 以后改用了 <code>QWebEngineView</code> ，并通过其提供的 <code>qwebchannel.js</code>  来进行交互。可能是由于刚出来的原因，这玩意儿有个 bug 就是必须在每次加载页面的时候手动注入，跳转页面后就失效了，需要手动注入，目前有没有修复具体未测试。这里对 <code>QWebView</code>  和 <code>QWebEngineView</code>  与 Js 交互都做了一个示例。</p>\n<span id=\"more\"></span>\n<h2 id=\"说明\"><a class=\"markdownIt-Anchor\" href=\"#说明\">#</a> 说明</h2>\n<ol>\n<li>针对 <code>QWebView</code>  通过 <code>QWebFrame</code>  的 <code>addToJavaScriptWindowObject</code>  把对象传递到 <code>Javascript</code>  中</li>\n<li>针对 <code>QWebEngineView</code>  通过 <code>QWebChannel.registerObject('Bridge', QObject)</code>  把对象传递到 <code>Javascript</code>  中</li>\n<li>可以通过 <code>@pyqtSlot</code>  装饰器来申明该方法可以暴露给 <code>Javascript</code>  调用</li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@pyqtSlot</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">callFromJs</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    QMessageBox<span class=\"token punctuation\">.</span>information<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token string\">\"提示\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"来自js调用：&#123;&#125;\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<ol start=\"4\">\n<li>针对 <code>QWebView</code>  在 <code>Javascript</code>  中获取该对象，可以通过该对象对窗口属性以及信号和暴露出的方法进行调用</li>\n</ol>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 这里绑定窗口的标题变化信号（这个信号是由QWidget内部的）</span>\nBridge<span class=\"token punctuation\">.</span>windowTitleChanged<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token function-variable function\">fun</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">title</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">showLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"标题被修改为：\"</span> <span class=\"token operator\">+</span> title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 绑定自定义的信号customSignal</span>\nBridge<span class=\"token punctuation\">.</span>customSignal<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token function-variable function\">fun</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">showLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到自定义信号内容：\"</span> <span class=\"token operator\">+</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"5\">\n<li>针对 <code>QWebEngineView</code>  在 <code>Javascript</code>  中获取该对象，可以通过该对象对窗口属性以及信号和暴露出的方法进行调用</li>\n</ol>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">QWebChannel</span><span class=\"token punctuation\">(</span>qt<span class=\"token punctuation\">.</span>webChannelTransport<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">channel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        window<span class=\"token punctuation\">.</span>Bridge <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>Bridge<span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// 这里绑定窗口的标题变化信号（这个信号是由QWidget内部的）</span>\n        Bridge<span class=\"token punctuation\">.</span>windowTitleChanged<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">title</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">showLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"标题被修改为：\"</span> <span class=\"token operator\">+</span> title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// 绑定自定义的信号customSignal</span>\n        Bridge<span class=\"token punctuation\">.</span>customSignal<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n           <span class=\"token function\">showLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到自定义信号内容：\"</span> <span class=\"token operator\">+</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h2>\n<p><code>QWebView</code> ： <a href=\"https://github.com/PyQt5/PyQt/blob/master/QWebView/JsSignals.py\">https://github.com/PyQt5/PyQt/blob/master/QWebView/JsSignals.py</a></p>\n<p><code>QWebEngineView</code> ： <a href=\"https://github.com/PyQt5/PyQt/blob/master/QWebEngineView/JsSignals.py\">https://github.com/PyQt5/PyQt/blob/master/QWebEngineView/JsSignals.py</a></p>\n<ol>\n<li>针对 <code>QWebView</code>  的核心实现</li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">WebView</span><span class=\"token punctuation\">(</span>QWebView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    customSignal <span class=\"token operator\">=</span> pyqtSignal<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>WebView<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>initSettings<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 暴露接口对象</span>\n        self<span class=\"token punctuation\">.</span>page<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>mainFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>javaScriptWindowObjectCleared<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_exposeInterface<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">_exposeInterface</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"向Js暴露调用本地方法接口\n        \"\"\"</span>\n        self<span class=\"token punctuation\">.</span>page<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>mainFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>addToJavaScriptWindowObject<span class=\"token punctuation\">(</span><span class=\"token string\">'Bridge'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># 注意pyqtSlot用于把该函数暴露给js可以调用</span>\n    <span class=\"token decorator annotation punctuation\">@pyqtSlot</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">callFromJs</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        QMessageBox<span class=\"token punctuation\">.</span>information<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token string\">\"提示\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"来自js调用：&#123;&#125;\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">sendCustomSignal</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 发送自定义信号</span>\n        self<span class=\"token punctuation\">.</span>customSignal<span class=\"token punctuation\">.</span>emit<span class=\"token punctuation\">(</span><span class=\"token string\">'当前时间: '</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"2\">\n<li>针对 <code>QWebEngineView</code>  的核心实现</li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">WebEngineView</span><span class=\"token punctuation\">(</span>QWebEngineView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    customSignal <span class=\"token operator\">=</span> pyqtSignal<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>WebEngineView<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> QWebChannel<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 把自身对象传递进去</span>\n        self<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>registerObject<span class=\"token punctuation\">(</span><span class=\"token string\">'Bridge'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 设置交互接口</span>\n        self<span class=\"token punctuation\">.</span>page<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setWebChannel<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># 注意pyqtSlot用于把该函数暴露给js可以调用</span>\n    <span class=\"token decorator annotation punctuation\">@pyqtSlot</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">callFromJs</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        QMessageBox<span class=\"token punctuation\">.</span>information<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token string\">\"提示\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"来自js调用：&#123;&#125;\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">sendCustomSignal</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 发送自定义信号</span>\n        self<span class=\"token punctuation\">.</span>customSignal<span class=\"token punctuation\">.</span>emit<span class=\"token punctuation\">(</span><span class=\"token string\">'当前时间: '</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"效果图\"><a class=\"markdownIt-Anchor\" href=\"#效果图\">#</a> 效果图</h2>\n<p><img src=\"/PyQt/QWebEngineView/ScreenShot/JsSignals.gif\" alt=\"JsSignals\"></p>\n",
            "tags": [
                "PyQt",
                "QWebView",
                "QWebEngineView",
                "浏览器"
            ]
        }
    ]
}