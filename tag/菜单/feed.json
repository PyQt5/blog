{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"菜单\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/mselectmenu.html",
            "url": "https://pyqt5.com/mselectmenu.html",
            "title": "PyQt5菜单之多选功能",
            "date_published": "2018-10-25T01:53:34.000Z",
            "content_html": "<p>有时候会遇到这种需求：在界面某个位置弹出一个菜单，其中里面的菜单项可以多选（类似配置选项），此时用 <code>QMenu</code>  会遇到点击一个菜单项就会自动关闭，当然可以通过其他方式实现该功能，不过这里就采用 <code>QMenu</code>  通过特殊的方式来实现该需求。</p>\n<span id=\"more\"></span>\n<h2 id=\"需求\"><a class=\"markdownIt-Anchor\" href=\"#需求\">#</a> 需求</h2>\n<p>要实现的效果：</p>\n<ol>\n<li>菜单 1</li>\n<li>菜单 2</li>\n<li>菜单 3</li>\n<li>菜单 4</li>\n</ol>\n<p>点击菜单 1、2、3 可以多选不关闭菜单</p>\n<p>点击菜单 4 可以勾选，并且关闭菜单</p>\n<h2 id=\"原理\"><a class=\"markdownIt-Anchor\" href=\"#原理\">#</a> 原理</h2>\n<ol>\n<li>设置菜单项可勾选：通过 <code>QAction.setCheckable(True)</code>  方法实现</li>\n<li>设置菜单不可关闭：通过覆盖 QMenu 的鼠标释放 <code>mouseReleaseEvent</code>  方法（可直接替换或者通过 <code>installEventFilter</code>  安装事件过滤器实现）</li>\n<li>在菜单的鼠标释放事件中，当点击菜单项后是通过点击点坐标来查找是否有 <code>QAction</code> ，然后触发对应的 <code>QAction</code> 。</li>\n<li>故在没有 <code>QAction</code>  的地方则直接交还给 <code>QMenu</code>  自行处理逻辑，在有 <code>QAction</code>  的地方可以根据自己的需求进行处理（如上所提）</li>\n</ol>\n<h2 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h2>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"\nCreated on 2018年10月24日\n@author: Irony\n@site: https://github.com/892768447\n@email: 892768447@qq.com\n@file: 菜单多选不关闭\n@description: \n\"\"\"</span>\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QWidget<span class=\"token punctuation\">,</span> QVBoxLayout<span class=\"token punctuation\">,</span> QLabel<span class=\"token punctuation\">,</span> QPushButton<span class=\"token punctuation\">,</span> QMenu<span class=\"token punctuation\">,</span>\\\n    QAction\n\n\n__Author__ <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"By: Irony\nQQ: 892768447\nEmail: 892768447@qq.com\"\"\"</span>\n__Copyright__ <span class=\"token operator\">=</span> <span class=\"token string\">\"Copyright (c) 2018 Irony\"</span>\n__Version__ <span class=\"token operator\">=</span> <span class=\"token string\">\"Version 1.0\"</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Window</span><span class=\"token punctuation\">(</span>QWidget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>Window<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        layout <span class=\"token operator\">=</span> QVBoxLayout<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>labelInfo <span class=\"token operator\">=</span> QLabel<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>button <span class=\"token operator\">=</span> QPushButton<span class=\"token punctuation\">(</span><span class=\"token string\">'带按钮的菜单'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span>\n        layout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>labelInfo<span class=\"token punctuation\">)</span>\n        layout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>button<span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># 添加菜单</span>\n        self<span class=\"token punctuation\">.</span>_initMenu<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">_initMenu</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 创建菜单</span>\n        self<span class=\"token punctuation\">.</span>_menu <span class=\"token operator\">=</span> QMenu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>button<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 替换menu的鼠标释放事件达到选择性不关闭菜单</span>\n        self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>mouseReleaseEvent <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_menu_mouseReleaseEvent\n        self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>addAction<span class=\"token punctuation\">(</span><span class=\"token string\">'菜单1'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>_checkAction<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>addAction<span class=\"token punctuation\">(</span><span class=\"token string\">'菜单2'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>_checkAction<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>addAction<span class=\"token punctuation\">(</span>\n            QAction<span class=\"token punctuation\">(</span><span class=\"token string\">'菜单3'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">,</span> triggered<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>_checkAction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        action <span class=\"token operator\">=</span> QAction<span class=\"token punctuation\">(</span><span class=\"token string\">'菜单4'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">,</span> triggered<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>_checkAction<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 添加自定义的属性,判断该属性可以关闭菜单</span>\n        action<span class=\"token punctuation\">.</span>setProperty<span class=\"token punctuation\">(</span><span class=\"token string\">'canHide'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>addAction<span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> action <span class=\"token keyword\">in</span> self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>actions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 循环设置可勾选</span>\n            action<span class=\"token punctuation\">.</span>setCheckable<span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>button<span class=\"token punctuation\">.</span>setMenu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">_menu_mouseReleaseEvent</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        action <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>actionAt<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> action<span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 没有找到action就交给QMenu自己处理</span>\n            <span class=\"token keyword\">return</span> QMenu<span class=\"token punctuation\">.</span>mouseReleaseEvent<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> action<span class=\"token punctuation\">.</span><span class=\"token builtin\">property</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canHide'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 如果有该属性则给菜单自己处理</span>\n            <span class=\"token keyword\">return</span> QMenu<span class=\"token punctuation\">.</span>mouseReleaseEvent<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 找到了QAction则只触发Action</span>\n        action<span class=\"token punctuation\">.</span>activate<span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>Trigger<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">_checkAction</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 三个action都响应该函数</span>\n        self<span class=\"token punctuation\">.</span>labelInfo<span class=\"token punctuation\">.</span>setText<span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'&#123;&#125;\\t选中：&#123;&#125;'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n            action<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">.</span>isChecked<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> action <span class=\"token keyword\">in</span> self<span class=\"token punctuation\">.</span>_menu<span class=\"token punctuation\">.</span>actions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">import</span> sys\n    <span class=\"token keyword\">import</span> cgitb\n    sys<span class=\"token punctuation\">.</span>excepthook <span class=\"token operator\">=</span> cgitb<span class=\"token punctuation\">.</span>enable<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QApplication\n    app <span class=\"token operator\">=</span> QApplication<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span>\n    w <span class=\"token operator\">=</span> Window<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    w<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span>\n    w<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>exec_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"效果图\"><a class=\"markdownIt-Anchor\" href=\"#效果图\">#</a> 效果图</h2>\n<p><img src=\"/PyQt/QMenu/ScreenShot/MultiSelect.gif\" alt=\"MultiSelect\"></p>\n",
            "tags": [
                "PyQt",
                "菜单"
            ]
        }
    ]
}