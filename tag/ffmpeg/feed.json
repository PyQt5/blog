{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"ffmpeg\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/ffmpeghls.html",
            "url": "https://pyqt5.com/ffmpeghls.html",
            "title": "FFmpeg合成加密HLS记录",
            "date_published": "2019-01-12T11:28:06.000Z",
            "content_html": "<p>记录在某个需求中要求截图并合成加密视频文件，这里采用 FFmpeg 的管道流来实现生成 HLS 加密文件。</p>\n<span id=\"more\"></span>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"\nCreated on 2019年3月4日\n@author: Irony\n@site: https://pyqt5.com https://github.com/892768447\n@email: 892768447@qq.com\n@file: \n@description: \n\"\"\"</span>\n\n<span class=\"token keyword\">from</span> pathlib <span class=\"token keyword\">import</span> Path\n<span class=\"token keyword\">from</span> subprocess <span class=\"token keyword\">import</span> Popen<span class=\"token punctuation\">,</span> PIPE\n\n\n__Author__ <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"By: Irony\nQQ: 892768447\nEmail: 892768447@qq.com\"\"\"</span>\n__Copyright__ <span class=\"token operator\">=</span> <span class=\"token string\">'Copyright (c) 2019 Irony'</span>\n__Version__ <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span>\n\n\n<span class=\"token comment\"># p = Popen([r'D:\\soft\\ffmpeg\\bin\\ffmpeg.exe', '-y',</span>\n<span class=\"token comment\">#            '-threads', '2',</span>\n<span class=\"token comment\">#            '-f', 'image2pipe',</span>\n<span class=\"token comment\">#            '-vcodec', 'mjpeg', '-r', '24', '-i', '-',</span>\n<span class=\"token comment\">#            '-vcodec', 'h264', '-r', '24',</span>\n<span class=\"token comment\">#            #            '-encryption_scheme', 'cenc-aes-ctr',</span>\n<span class=\"token comment\">#            #            '-encryption_key', '617D8A125A284DF48E3C6B1866348A3F',</span>\n<span class=\"token comment\">#            #            '-encryption_kid', 'B326F895B6A24CC5A4DC70995728059C',</span>\n<span class=\"token comment\">#            r'F:\\Workspace\\Test\\videos\\video.mp4'], stdin=PIPE)</span>\n\np <span class=\"token operator\">=</span> Popen<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">r'D:\\soft\\ffmpeg\\bin\\ffmpeg.exe'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token string\">'-re'</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\"># 按照实际帧率读取输入文件</span>\n           <span class=\"token string\">'-y'</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\"># 覆盖已存在文件</span>\n           <span class=\"token string\">'-threads'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 线程数量</span>\n           <span class=\"token string\">'-f'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'image2pipe'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># PIPE图片流</span>\n           <span class=\"token string\">'-vcodec'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mjpeg'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 图片编码</span>\n           <span class=\"token string\">'-r'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'24'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 帧率</span>\n           <span class=\"token string\">'-i'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 指定输入流为PIPE</span>\n           <span class=\"token string\">'-vcodec'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'h264'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 输出编码</span>\n           <span class=\"token string\">'-r'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'24'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 帧率</span>\n           <span class=\"token string\">'-map'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">#            '-crf','20',     # 降低质量</span>\n           <span class=\"token string\">'-b'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'720k'</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\"># 码率</span>\n           <span class=\"token string\">'-f'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hls'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token string\">'-codec:v'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'libx264'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token string\">'-vbsf'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'h264_mp4toannexb'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token comment\"># 指定加密密匙文件</span>\n           <span class=\"token string\">'-hls_key_info_file'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">r'F:\\Workspace\\Test\\videokey.info'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token string\">'-hls_time'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'20'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token string\">'-hls_list_size'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token string\">'-hls_wrap'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">#            '-hls_flags', 'single_file',  # 生成单个文件(有bug)</span>\n           <span class=\"token string\">r'F:\\Workspace\\Test\\videos\\playlist.m3u8'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> stdin<span class=\"token operator\">=</span>PIPE<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span>\n\nt <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">24</span>\n<span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> path <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>Path<span class=\"token punctuation\">(</span><span class=\"token string\">'frames'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>rglob<span class=\"token punctuation\">(</span><span class=\"token string\">'*.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\">#     print(i, path)</span>\n    p<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'rb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\np<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span>wait<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>",
            "tags": [
                "Python",
                "FFmpeg",
                "HLS"
            ]
        }
    ]
}