{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"轮播\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/pageswitching.html",
            "url": "https://pyqt5.com/pageswitching.html",
            "title": "PyQt5之图片轮播",
            "date_published": "2018-11-24T13:45:06.000Z",
            "content_html": "<p>之前看到了 <code>QStackedWidget</code>  做切换动画，让界面不那么生硬，于是参考了 <a href=\"http://qt.shoutwiki.com/wiki/Extending_QStackedWidget_for_sliding_page_animations_in_Qt\">http://qt.shoutwiki.com/wiki/Extending_QStackedWidget_for_sliding_page_animations_in_Qt</a> 做了一个 <code>QStackedWidget</code>  的切换动画，然后利用 <code>QStackedWidget</code>  结合多个 <code>QLabel</code>  显示图片来做一个轮播效果。</p>\n<p>其实在写之前也在网上找了很多例子，参看过后发现大多例子都是利用到了 <code>paintEvent</code>  去绘制，这样其实还是比较麻烦，个人觉得更好的方式是使用 <code>QPropertyAnimation</code>  属性动画修改控件中 <code>QLabel</code>  图片控件的 pos 位置属性就可以达到移动效果了。</p>\n<span id=\"more\"></span>\n<ol>\n<li>比较核心的算法就是要计算当前页面和下一个页面的位置偏移量，比如:</li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\"># 计算偏移量</span>\noffsetX <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>frameRect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\noffsetY <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>frameRect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nw_next<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> offsetX<span class=\"token punctuation\">,</span> offsetY<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> direction <span class=\"token operator\">==</span> self<span class=\"token punctuation\">.</span>BOTTOM2TOP<span class=\"token punctuation\">:</span>\n    offsetX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    offsetY <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>offsetY\n<span class=\"token keyword\">elif</span> direction <span class=\"token operator\">==</span> self<span class=\"token punctuation\">.</span>TOP2BOTTOM<span class=\"token punctuation\">:</span>\n    offsetX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">elif</span> direction <span class=\"token operator\">==</span> self<span class=\"token punctuation\">.</span>RIGHT2LEFT<span class=\"token punctuation\">:</span>\n    offsetX <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>offsetX\n    offsetY <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">elif</span> direction <span class=\"token operator\">==</span> self<span class=\"token punctuation\">.</span>LEFT2RIGHT<span class=\"token punctuation\">:</span>\n    offsetY <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token comment\"># 重新定位显示区域外部/旁边的下一个窗口小部件</span>\npnext <span class=\"token operator\">=</span> w_next<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\npnow <span class=\"token operator\">=</span> w_now<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nself<span class=\"token punctuation\">.</span>_pnow <span class=\"token operator\">=</span> pnow\n\n<span class=\"token comment\"># 移动到指定位置并显示</span>\nw_next<span class=\"token punctuation\">.</span>move<span class=\"token punctuation\">(</span>pnext<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> offsetX<span class=\"token punctuation\">,</span> pnext<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> offsetY<span class=\"token punctuation\">)</span>\nw_next<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nw_next<span class=\"token punctuation\">.</span>raise_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"2\">\n<li>\n<p>其次是对这两个页面增加关联 <code>pos</code>  属性的 <code>QPropertyAnimation</code>  动画，然后加入到并行动画组 <code>QParallelAnimationGroup</code>  中再启动即可。</p>\n</li>\n<li>\n<p>对 <code>QStackedWidget</code>  的 <code>setCurrentIndex</code>  和 <code>setCurrentWidget</code>  这两个函数进行了覆盖重写达到及时手动调用这两个函数也会产生动画效果的目的。</p>\n</li>\n</ol>\n<h2 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h2>\n<p><a href=\"https://github.com/PyQt5/PyQt/blob/master/QPropertyAnimation/PageSwitching.py\">https://github.com/PyQt5/PyQt/blob/master/QPropertyAnimation/PageSwitching.py</a></p>\n<h2 id=\"效果图\"><a class=\"markdownIt-Anchor\" href=\"#效果图\">#</a> 效果图</h2>\n<p><img src=\"/PyQt/QPropertyAnimation/ScreenShot/PageSwitching.gif\" alt=\"PageSwitching\"></p>\n",
            "tags": [
                "PyQt",
                "动画",
                "轮播"
            ]
        }
    ]
}