{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"异步\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/pyqt5asyncio.html",
            "url": "https://pyqt5.com/pyqt5asyncio.html",
            "title": "PyQt5结合Asyncio异步",
            "date_published": "2018-10-24T06:32:26.000Z",
            "content_html": "<p>今天尝试了下<a href=\"https://github.com/harvimt/quamash\"> quamash</a> 框架，该框架是一个 <code>PyQt</code>  的异步事件循环封装库，使用 Python3+ 的 <code>asyncio</code>  这个异步库。在看了该项目的内容后发现只有一个简单的进度条例子，故尝试用其来下载网络图片并显示。</p>\n<span id=\"more\"></span>\n<h2 id=\"安装依赖\"><a class=\"markdownIt-Anchor\" href=\"#安装依赖\">#</a> 安装依赖</h2>\n<ol>\n<li>pip install quamash</li>\n<li>pip install aiohttp</li>\n<li>Python3.5+ 和 PyQt5</li>\n</ol>\n<p>这里使用 <code>aiohttp</code>  是因为它基于 <code>asyncio</code>  封装的网络操作库，常见的 <code>get</code> 、 <code>post</code>  等方法，不过它只支持 Python3.5 及以上的版本，主要是它使用了 async def 这样的语法。</p>\n<h2 id=\"说明\"><a class=\"markdownIt-Anchor\" href=\"#说明\">#</a> 说明</h2>\n<ol>\n<li>在创建 <code>QApplication</code>  后随即设置替换事件循环 <code>loop</code></li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">app <span class=\"token operator\">=</span> QApplication<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span>\nloop <span class=\"token operator\">=</span> QEventLoop<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\nasyncio<span class=\"token punctuation\">.</span>set_event_loop<span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span>\nw <span class=\"token operator\">=</span> Window<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"2\">\n<li>通过 <code>asyncio.ensure_future(func(), loop=loop)</code>  来执行某个异步函数</li>\n</ol>\n<h2 id=\"流程\"><a class=\"markdownIt-Anchor\" href=\"#流程\">#</a> 流程</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:right\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Window</td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:right\">initSession（初始化 session）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">↓</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:right\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">下载按钮</td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:right\">doDownload（执行_doDownload 方法）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">↓</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:right\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">session.get（下载 json 数据进行解析）</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:right\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">↓</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:right\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">添加到界面</td>\n<td style=\"text-align:center\">←</td>\n<td style=\"text-align:right\">_doDownloadImage（对单张图片进行下载）</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"源码\"><a class=\"markdownIt-Anchor\" href=\"#源码\">#</a> 源码</h2>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"\nCreated on 2018年10月24日\n@author: Irony\n@site: https://github.com/892768447\n@email: 892768447@qq.com\n@file: AsyncioUiClient\n@description: \n\"\"\"</span>\n<span class=\"token keyword\">import</span> asyncio\n\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtCore <span class=\"token keyword\">import</span> Qt\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtGui <span class=\"token keyword\">import</span> QPixmap<span class=\"token punctuation\">,</span> QMovie\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QWidget<span class=\"token punctuation\">,</span> QVBoxLayout<span class=\"token punctuation\">,</span> QPushButton<span class=\"token punctuation\">,</span>\\\n    QApplication<span class=\"token punctuation\">,</span> QListWidget<span class=\"token punctuation\">,</span> QListWidgetItem<span class=\"token punctuation\">,</span> QLabel<span class=\"token punctuation\">,</span> QMessageBox\n<span class=\"token keyword\">import</span> aiohttp\n<span class=\"token keyword\">from</span> quamash <span class=\"token keyword\">import</span> QEventLoop\n\n\n__Author__ <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"By: Irony\nQQ: 892768447\nEmail: 892768447@qq.com\"\"\"</span>\n__Copyright__ <span class=\"token operator\">=</span> <span class=\"token string\">\"Copyright (c) 2018 Irony\"</span>\n__Version__ <span class=\"token operator\">=</span> <span class=\"token string\">\"Version 1.0\"</span>\n\nUrl <span class=\"token operator\">=</span> <span class=\"token string\">'https://www.doutula.com/api/search?keyword=%E6%9C%80%E6%96%B0%E8%A1%A8%E6%83%85&amp;mime=0&amp;page=&#123;&#125;'</span>\nHeaders <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token string\">':authority'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'www.doutula.com'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">':method'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">':scheme'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'https'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'accept'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'accept-language'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'zh-CN,zh;q=0.9'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'cache-control'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'max-age=0'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'dnt'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'upgrade-insecure-requests'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'user-agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.26 Safari/537.36 Core/1.63.6756.400 QQBrowser/10.2.2498.400'</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Window</span><span class=\"token punctuation\">(</span>QWidget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>Window<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        layout <span class=\"token operator\">=</span> QVBoxLayout<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>listWidget <span class=\"token operator\">=</span> QListWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>setSpacing<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># item直接的间隔</span>\n        <span class=\"token comment\"># 隐藏横向滚动条</span>\n        self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>setHorizontalScrollBarPolicy<span class=\"token punctuation\">(</span>Qt<span class=\"token punctuation\">.</span>ScrollBarAlwaysOff<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 让list 从左到右排列</span>\n        self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>setFlow<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>LeftToRight<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 自动换行</span>\n        self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>setWrapping<span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>setResizeMode<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>Adjust<span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>buttonMsg <span class=\"token operator\">=</span> QPushButton<span class=\"token punctuation\">(</span><span class=\"token string\">'弹出提示框'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">,</span> clicked<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>showMessage<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>buttonDown <span class=\"token operator\">=</span> QPushButton<span class=\"token punctuation\">(</span><span class=\"token string\">'下载图片'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">,</span> clicked<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>doDownload<span class=\"token punctuation\">)</span>\n        layout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">)</span>\n        layout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>buttonMsg<span class=\"token punctuation\">)</span>\n        layout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>buttonDown<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>currentPage <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        self<span class=\"token punctuation\">.</span>initSession<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 其实没必要，session主要用在需要登录的网站。缓存cookie用</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">initSession</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">_initSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 初始化session</span>\n            self<span class=\"token punctuation\">.</span>session <span class=\"token operator\">=</span> aiohttp<span class=\"token punctuation\">.</span>ClientSession<span class=\"token punctuation\">(</span>loop<span class=\"token operator\">=</span>loop<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">)</span>\n        asyncio<span class=\"token punctuation\">.</span>ensure_future<span class=\"token punctuation\">(</span>_initSession<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> loop<span class=\"token operator\">=</span>loop<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">_doDownloadImage</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 下载图片并添加到界面</span>\n        <span class=\"token keyword\">async</span> <span class=\"token keyword\">with</span> self<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> resp<span class=\"token punctuation\">:</span>\n            data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> resp<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> data<span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'下载失败: '</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">return</span>\n            path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token string\">'tmp'</span><span class=\"token punctuation\">,</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>basename<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token string\">'wb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> fp<span class=\"token punctuation\">:</span>\n                fp<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n            item <span class=\"token operator\">=</span> QListWidgetItem<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">)</span>\n            image <span class=\"token operator\">=</span> QPixmap<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span>\n            item<span class=\"token punctuation\">.</span>setSizeHint<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            label <span class=\"token operator\">=</span> QLabel<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">)</span>\n            label<span class=\"token punctuation\">.</span>setPixmap<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> path<span class=\"token punctuation\">.</span>endswith<span class=\"token punctuation\">(</span><span class=\"token string\">'.gif'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 可能是动态图</span>\n                label<span class=\"token punctuation\">.</span>setMovie<span class=\"token punctuation\">(</span>QMovie<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>setItemWidget<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> label<span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>listWidget<span class=\"token punctuation\">.</span>scrollToBottom<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">_doDownload</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 下载工作</span>\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>currentPage <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n            QMessageBox<span class=\"token punctuation\">.</span>information<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token string\">'提示'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'已经没有更多了'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span>\n        self<span class=\"token punctuation\">.</span>currentPage <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        url <span class=\"token operator\">=</span> Url<span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>currentPage<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'get url: '</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">async</span> <span class=\"token keyword\">with</span> self<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span>Headers<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> resp<span class=\"token punctuation\">:</span>\n            data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> resp<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> data<span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span>\n            data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> data<span class=\"token punctuation\">:</span>\n                self<span class=\"token punctuation\">.</span>currentPage <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'已经是最后一页了'</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">return</span>\n            <span class=\"token comment\"># 解析json并生成item添加到界面中</span>\n            <span class=\"token keyword\">for</span> entity <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'list'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                url <span class=\"token operator\">=</span> entity<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'image_url'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> url<span class=\"token punctuation\">:</span>\n                    <span class=\"token keyword\">continue</span>\n                <span class=\"token keyword\">await</span> self<span class=\"token punctuation\">.</span>_doDownloadImage<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 下载图片</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">doDownload</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 响应按钮点击调用</span>\n        asyncio<span class=\"token punctuation\">.</span>ensure_future<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_doDownload<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> loop<span class=\"token operator\">=</span>loop<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">showMessage</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 显示对话框</span>\n        app<span class=\"token punctuation\">.</span>aboutQt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">closeEvent</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> self<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>closed<span class=\"token punctuation\">:</span>\n            asyncio<span class=\"token punctuation\">.</span>ensure_future<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> loop<span class=\"token operator\">=</span>loop<span class=\"token punctuation\">)</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>Window<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>closeEvent<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">import</span> sys\n    <span class=\"token keyword\">import</span> cgitb\n    <span class=\"token keyword\">import</span> os\n    os<span class=\"token punctuation\">.</span>makedirs<span class=\"token punctuation\">(</span><span class=\"token string\">'tmp'</span><span class=\"token punctuation\">,</span> exist_ok<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>excepthook <span class=\"token operator\">=</span> cgitb<span class=\"token punctuation\">.</span>enable<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n    app <span class=\"token operator\">=</span> QApplication<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span>\n    loop <span class=\"token operator\">=</span> QEventLoop<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n    asyncio<span class=\"token punctuation\">.</span>set_event_loop<span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span>\n    w <span class=\"token operator\">=</span> Window<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    w<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">with</span> loop<span class=\"token punctuation\">:</span>\n        loop<span class=\"token punctuation\">.</span>run_forever<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"效果图\"><a class=\"markdownIt-Anchor\" href=\"#效果图\">#</a> 效果图</h2>\n<p><img src=\"/images/pyqt5asyncio.gif\" alt=\"pyqt5asyncio\"></p>\n",
            "tags": [
                "PyQt",
                "Asyncio",
                "异步"
            ]
        }
    ]
}