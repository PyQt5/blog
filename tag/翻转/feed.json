{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"翻转\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/flipwidgetanimation.html",
            "url": "https://pyqt5.com/flipwidgetanimation.html",
            "title": "PyQt5窗口翻转动画",
            "date_published": "2019-05-15T14:48:00.000Z",
            "content_html": "<p>QQ 的界面一直是用来模仿练习做界面的好东西，这里就有一个类似 QQ 登录界面的实现翻转效果，当然这里并没有用两个窗口去做，而是用了 <code>QStackedWidget</code>  包含两个控件做切换，同时单独使用一个窗口做动画绘制。</p>\n<span id=\"more\"></span>\n<h2 id=\"原理说明\"><a class=\"markdownIt-Anchor\" href=\"#原理说明\">#</a> 原理说明</h2>\n<ol>\n<li>用了两个 <code>QLabel</code>  来显示模拟的图片界面，并实现鼠标点击模拟真实的窗口对应位置点击</li>\n<li>用了 <code>QStackedWidget</code>  来存放上面的两个界面 <code>QLabel</code></li>\n<li>点击切换时主要是对上面的两个界面进行截图并传递给翻转动画窗口</li>\n<li>通过 <code>setWindowOpacity</code>  控制主窗口的显示隐藏（保留任务栏），当然也可以用 <code>hide</code></li>\n<li>动画窗口 <code>FlipWidget.py</code>  主要实现两张图片的翻转显示，考虑到 0-90 和 90-180 之前的情况，以及图片的缩放动画</li>\n</ol>\n<h2 id=\"核心实现\"><a class=\"markdownIt-Anchor\" href=\"#核心实现\">#</a> 核心实现</h2>\n<ol>\n<li>主要是在 <code>paintEvent</code>  方法中使用 <code>QTransform</code>  对 <code>QPainter</code>  进行圆心变换以及 <code>rotate</code>  设置翻转角度</li>\n<li>同时根据翻转的角度范围对图片进行切换和缩放</li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">paintEvent</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>FlipWidget<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>paintEvent<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token builtin\">hasattr</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token string\">'image1'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> <span class=\"token builtin\">hasattr</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token string\">'image2'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> self<span class=\"token punctuation\">.</span>isVisible<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n        painter <span class=\"token operator\">=</span> QPainter<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        painter<span class=\"token punctuation\">.</span>setRenderHint<span class=\"token punctuation\">(</span>QPainter<span class=\"token punctuation\">.</span>Antialiasing<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        painter<span class=\"token punctuation\">.</span>setRenderHint<span class=\"token punctuation\">(</span>QPainter<span class=\"token punctuation\">.</span>SmoothPixmapTransform<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># 变换</span>\n        transform <span class=\"token operator\">=</span> QTransform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 把圆心设置为矩形中心</span>\n        transform<span class=\"token punctuation\">.</span>translate<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>_angle <span class=\"token operator\">>=</span> <span class=\"token operator\">-</span><span class=\"token number\">90</span> <span class=\"token keyword\">and</span> self<span class=\"token punctuation\">.</span>_angle <span class=\"token operator\">&lt;=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 当翻转角度在90范围内显示第一张图，且从大图缩放到小图的过程</span>\n            painter<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\"># 设置翻转角度</span>\n            transform<span class=\"token punctuation\">.</span>rotate<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_angle<span class=\"token punctuation\">,</span> Qt<span class=\"token punctuation\">.</span>YAxis<span class=\"token punctuation\">)</span>\n            painter<span class=\"token punctuation\">.</span>setTransform<span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">)</span>\n            <span class=\"token comment\"># 缩放图片高度</span>\n            width <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>image1<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n            height <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>image1<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>\n                         <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token builtin\">abs</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_angle <span class=\"token operator\">/</span> self<span class=\"token punctuation\">.</span>Scale<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            image <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>image1<span class=\"token punctuation\">.</span>scaled<span class=\"token punctuation\">(</span>\n                self<span class=\"token punctuation\">.</span>image1<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">,</span>\n                Qt<span class=\"token punctuation\">.</span>IgnoreAspectRatio<span class=\"token punctuation\">,</span> Qt<span class=\"token punctuation\">.</span>SmoothTransformation<span class=\"token punctuation\">)</span>\n            painter<span class=\"token punctuation\">.</span>drawPixmap<span class=\"token punctuation\">(</span>\n                QPointF<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>width<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>height <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span>\n            painter<span class=\"token punctuation\">.</span>restore<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 当翻转角度在90范围内显示第二张图，且从小图缩放到原图的过程</span>\n            painter<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>_angle <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                angle <span class=\"token operator\">=</span> <span class=\"token number\">180</span> <span class=\"token operator\">+</span> self<span class=\"token punctuation\">.</span>_angle\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                angle <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>_angle <span class=\"token operator\">-</span> <span class=\"token number\">180</span>\n            <span class=\"token comment\"># 设置翻转角度， 注意这里角度有差异</span>\n            transform<span class=\"token punctuation\">.</span>rotate<span class=\"token punctuation\">(</span>angle<span class=\"token punctuation\">,</span> Qt<span class=\"token punctuation\">.</span>YAxis<span class=\"token punctuation\">)</span>\n            painter<span class=\"token punctuation\">.</span>setTransform<span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">)</span>\n            <span class=\"token comment\"># 缩放图片高度</span>\n            width <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>image2<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n            height <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>image2<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>\n                         <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">-</span> <span class=\"token builtin\">abs</span><span class=\"token punctuation\">(</span>angle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> self<span class=\"token punctuation\">.</span>Scale <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            image <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>image2<span class=\"token punctuation\">.</span>scaled<span class=\"token punctuation\">(</span>\n                self<span class=\"token punctuation\">.</span>image2<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">,</span>\n                Qt<span class=\"token punctuation\">.</span>IgnoreAspectRatio<span class=\"token punctuation\">,</span> Qt<span class=\"token punctuation\">.</span>SmoothTransformation<span class=\"token punctuation\">)</span>\n            painter<span class=\"token punctuation\">.</span>drawPixmap<span class=\"token punctuation\">(</span>\n                QPointF<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>width<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>height <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span>\n            painter<span class=\"token punctuation\">.</span>restore<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h2>\n<p><a href=\"https://github.com/PyQt5/PyQt/blob/master/QPropertyAnimation/FlipWidgetAnimation.py\">https://github.com/PyQt5/PyQt/blob/master/QPropertyAnimation/FlipWidgetAnimation.py</a></p>\n<h2 id=\"效果图\"><a class=\"markdownIt-Anchor\" href=\"#效果图\">#</a> 效果图</h2>\n<p><img src=\"/PyQt/QPropertyAnimation/ScreenShot/FlipWidgetAnimation.gif\" alt=\"FlipWidgetAnimation\"></p>\n",
            "tags": [
                "PyQt",
                "动画",
                "翻转"
            ]
        }
    ]
}