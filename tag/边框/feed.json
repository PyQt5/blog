{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"边框\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/showframe.html",
            "url": "https://pyqt5.com/showframe.html",
            "title": "PyQt5调整窗口显示边框",
            "date_published": "2019-04-26T14:19:26.000Z",
            "content_html": "<p>在 <code>windows</code>  某些场景下调整窗口大小或者移动后就会导致里面的内容重绘（速度慢，卡顿，闪烁），其实在以前 <code>windows</code>  在低配置设备为了减少这种频繁绘制的情况，默认会开启这种效果，不过目前设备越来越好了就关闭了该功能。具体是在控制面板中 -&gt; 调整 <code>Windows</code>  的外观和性能 -&gt; 去掉勾选 拖动时显示窗口内容。</p>\n<span id=\"more\"></span>\n<p>由于这个开关是全局状态的，而我们只需要在自己的窗口中实现该效果有两种方式。</p>\n<ol>\n<li>一种是自己绘制一个边框效果，放开鼠标时才操作真正的窗口。</li>\n<li>二是替换窗口的处理过程函数 <code>wndproc</code>  处理 <code>WM_NCLBUTTONDOWN</code>  消息事件。</li>\n</ol>\n<p>今天讲第二种方法：</p>\n<ol>\n<li>需要了解  <code>SystemParametersInfo</code>  API 函数</li>\n<li><code>SPI_GETDRAGFULLWINDOWS</code> ：确定是否允许拖拉到最大窗口</li>\n<li><code>SPI_SETDRAGFULLWINDOWS</code> ：设置是否允许拖至最大窗口</li>\n</ol>\n<p>效果就是这样的：</p>\n<p><img src=\"/PyQt/Demo/ScreenShot/ShowFrameWhenDrag.gif\" alt=\"ShowFrameWhenDrag\"></p>\n<p>正如图片所看的那样，窗体在移动的时候，窗体并没有绘制出来，而是绘制出窗体的边框，等到窗体不在移动的时候就直接把窗体图像数据全部绘制出来，这样就避免了窗体在移动的时候出现闪烁的现象。</p>\n<h2 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h2>\n<p><a href=\"https://github.com/PyQt5/PyQt/blob/master/Demo/ShowFrameWhenDrag.py\">https://github.com/PyQt5/PyQt/blob/master/Demo/ShowFrameWhenDrag.py</a></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"\nCreated on 2019年4月23日\n@author: Irony\n@site: https://pyqt5.com https://github.com/892768447\n@email: 892768447@qq.com\n@file: ShowFrameWhenDrag\n@description: 调整窗口显示边框\n\"\"\"</span>\n<span class=\"token keyword\">from</span> ctypes <span class=\"token keyword\">import</span> sizeof<span class=\"token punctuation\">,</span> windll<span class=\"token punctuation\">,</span> c_int<span class=\"token punctuation\">,</span> byref<span class=\"token punctuation\">,</span> c_long<span class=\"token punctuation\">,</span> c_void_p<span class=\"token punctuation\">,</span> c_ulong<span class=\"token punctuation\">,</span> c_longlong<span class=\"token punctuation\">,</span>\\\n    c_ulonglong<span class=\"token punctuation\">,</span> WINFUNCTYPE<span class=\"token punctuation\">,</span> c_uint\n\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QWidget<span class=\"token punctuation\">,</span> QVBoxLayout<span class=\"token punctuation\">,</span> QLabel\n\n\n__Author__ <span class=\"token operator\">=</span> <span class=\"token string\">'Irony'</span>\n__Copyright__ <span class=\"token operator\">=</span> <span class=\"token string\">'Copyright (c) 2019 Irony'</span>\n__Version__ <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span>\n\n<span class=\"token keyword\">if</span> sizeof<span class=\"token punctuation\">(</span>c_long<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> sizeof<span class=\"token punctuation\">(</span>c_void_p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    WPARAM <span class=\"token operator\">=</span> c_ulong\n    LPARAM <span class=\"token operator\">=</span> c_long\n<span class=\"token keyword\">elif</span> sizeof<span class=\"token punctuation\">(</span>c_longlong<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> sizeof<span class=\"token punctuation\">(</span>c_void_p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    WPARAM <span class=\"token operator\">=</span> c_ulonglong\n    LPARAM <span class=\"token operator\">=</span> c_longlong\n\nWM_NCLBUTTONDOWN <span class=\"token operator\">=</span> <span class=\"token number\">0x00a1</span>\nGWL_WNDPROC <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">4</span>\nSPI_GETDRAGFULLWINDOWS <span class=\"token operator\">=</span> <span class=\"token number\">38</span>\nSPI_SETDRAGFULLWINDOWS <span class=\"token operator\">=</span> <span class=\"token number\">37</span>\nWNDPROC <span class=\"token operator\">=</span> WINFUNCTYPE<span class=\"token punctuation\">(</span>c_long<span class=\"token punctuation\">,</span> c_void_p<span class=\"token punctuation\">,</span> c_uint<span class=\"token punctuation\">,</span> WPARAM<span class=\"token punctuation\">,</span> LPARAM<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    CallWindowProc <span class=\"token operator\">=</span> windll<span class=\"token punctuation\">.</span>user32<span class=\"token punctuation\">.</span>CallWindowProcW\n    SetWindowLong <span class=\"token operator\">=</span> windll<span class=\"token punctuation\">.</span>user32<span class=\"token punctuation\">.</span>SetWindowLongW\n    SystemParametersInfo <span class=\"token operator\">=</span> windll<span class=\"token punctuation\">.</span>user32<span class=\"token punctuation\">.</span>SystemParametersInfoW\n<span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span>\n    CallWindowProc <span class=\"token operator\">=</span> windll<span class=\"token punctuation\">.</span>user32<span class=\"token punctuation\">.</span>CallWindowProcA\n    SetWindowLong <span class=\"token operator\">=</span> windll<span class=\"token punctuation\">.</span>user32<span class=\"token punctuation\">.</span>SetWindowLongA\n    SystemParametersInfo <span class=\"token operator\">=</span> windll<span class=\"token punctuation\">.</span>user32<span class=\"token punctuation\">.</span>SystemParametersInfoA\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">GetDragFullwindows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    rv <span class=\"token operator\">=</span> c_int<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    SystemParametersInfo<span class=\"token punctuation\">(</span>SPI_GETDRAGFULLWINDOWS<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> byref<span class=\"token punctuation\">(</span>rv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> rv<span class=\"token punctuation\">.</span>value\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">SetDragFullwindows</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    SystemParametersInfo<span class=\"token punctuation\">(</span>SPI_SETDRAGFULLWINDOWS<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Window</span><span class=\"token punctuation\">(</span>QWidget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>Window<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        layout <span class=\"token operator\">=</span> QVBoxLayout<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        layout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>QLabel<span class=\"token punctuation\">(</span><span class=\"token string\">'拖动或者调整窗口试试看'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># 重点替换窗口处理过程</span>\n        self<span class=\"token punctuation\">.</span>_newwndproc <span class=\"token operator\">=</span> WNDPROC<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_wndproc<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>_oldwndproc <span class=\"token operator\">=</span> SetWindowLong<span class=\"token punctuation\">(</span>\n            <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>winId<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> GWL_WNDPROC<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>_newwndproc<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">_wndproc</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> hwnd<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> wparam<span class=\"token punctuation\">,</span> lparam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> msg <span class=\"token operator\">==</span> WM_NCLBUTTONDOWN<span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 获取系统本身是否已经开启</span>\n            isDragFullWindow <span class=\"token operator\">=</span> GetDragFullwindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> isDragFullWindow <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                <span class=\"token comment\"># 开启虚线框</span>\n                SetDragFullwindows<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n                <span class=\"token comment\"># 系统本身处理</span>\n                ret <span class=\"token operator\">=</span> CallWindowProc<span class=\"token punctuation\">(</span>\n                    self<span class=\"token punctuation\">.</span>_oldwndproc<span class=\"token punctuation\">,</span> hwnd<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> wparam<span class=\"token punctuation\">,</span> lparam<span class=\"token punctuation\">)</span>\n                <span class=\"token comment\"># 关闭虚线框</span>\n                SetDragFullwindows<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">return</span> ret\n        <span class=\"token keyword\">return</span> CallWindowProc<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>_oldwndproc<span class=\"token punctuation\">,</span> hwnd<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> wparam<span class=\"token punctuation\">,</span> lparam<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">import</span> sys\n    <span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QApplication\n    app <span class=\"token operator\">=</span> QApplication<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span>\n    w <span class=\"token operator\">=</span> Window<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    w<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>exec_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"片尾\"><a class=\"markdownIt-Anchor\" href=\"#片尾\">#</a> 片尾</h2>\n<p>替换窗口过程可以处理很多系统窗口的处理过程，更多需要读者自行去发现。</p>\n",
            "tags": [
                "PyQt",
                "边框"
            ]
        }
    ]
}