{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"窗口\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/followwindow.html",
            "url": "https://pyqt5.com/followwindow.html",
            "title": "PyQt5窗口跟随其它窗口",
            "date_published": "2018-10-23T07:08:56.000Z",
            "content_html": "<p>要实现 <code>PyQt</code>  窗口跟随其它外部的窗口，能想到两点办法，一个是 hook 系统事件得到目标窗口的位置和大小以及是否关闭等，二是通过循环检测窗口的位置来实现。</p>\n<span id=\"more\"></span>\n<h2 id=\"基于windows定时检测目标窗口\"><a class=\"markdownIt-Anchor\" href=\"#基于windows定时检测目标窗口\">#</a> 基于 Windows 定时检测目标窗口</h2>\n<ol>\n<li>利用 <code>win32gui</code>  模块获取目标窗口的句柄</li>\n<li>通过句柄获取目标窗口的大小位置，并设置自己的位置</li>\n<li>主要是检测时间，在 10 毫秒以下很流畅</li>\n<li>窗口关闭是根据目标句柄无效来判断</li>\n</ol>\n<p><a href=\"https://github.com/PyQt5/PyQt/blob/master/Demo/FollowWindow.py\">https://github.com/PyQt5/PyQt/blob/master/Demo/FollowWindow.py</a></p>\n<h2 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h2>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n\n<span class=\"token triple-quoted-string string\">\"\"\"\nCreated on 2018年10月22日\n@author: Irony\n@site: https://github.com/892768447\n@email: 892768447@qq.com\n@file: FollowWindow\n@description: \n\"\"\"</span>\n<span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtCore <span class=\"token keyword\">import</span> QTimer\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QWidget<span class=\"token punctuation\">,</span> QVBoxLayout<span class=\"token punctuation\">,</span> QPushButton\n<span class=\"token keyword\">import</span> win32gui\n\n\n__Author__ <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"By: Irony\nQQ: 892768447\nEmail: 892768447@qq.com\"\"\"</span>\n__Copyright__ <span class=\"token operator\">=</span> <span class=\"token string\">\"Copyright (c) 2018 Irony\"</span>\n__Version__ <span class=\"token operator\">=</span> <span class=\"token string\">\"Version 1.0\"</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Window</span><span class=\"token punctuation\">(</span>QWidget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>Window<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n        layout <span class=\"token operator\">=</span> QVBoxLayout<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        layout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>QPushButton<span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>tmpHwnd <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n        <span class=\"token comment\"># 启动定时器检测记事本的位置大小和是否关闭</span>\n        self<span class=\"token punctuation\">.</span>checkTimer <span class=\"token operator\">=</span> QTimer<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> timeout<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>checkWindow<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>checkTimer<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 10毫秒比较流畅</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">checkWindow</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 查找</span>\n        hwnd <span class=\"token operator\">=</span> win32gui<span class=\"token punctuation\">.</span>FindWindow<span class=\"token punctuation\">(</span><span class=\"token string\">'Notepad'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>tmpHwnd <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> hwnd<span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 表示记事本关闭了</span>\n            self<span class=\"token punctuation\">.</span>checkTimer<span class=\"token punctuation\">.</span>stop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 关闭自己</span>\n            <span class=\"token keyword\">return</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> hwnd<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span>\n        self<span class=\"token punctuation\">.</span>tmpHwnd <span class=\"token operator\">=</span> hwnd\n        <span class=\"token comment\"># 获取位置</span>\n        rect <span class=\"token operator\">=</span> win32gui<span class=\"token punctuation\">.</span>GetWindowRect<span class=\"token punctuation\">(</span>hwnd<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>rect<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>move<span class=\"token punctuation\">(</span>rect<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">import</span> sys\n    <span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QApplication\n    <span class=\"token comment\"># 先检测是否已有记事本打开</span>\n    hwnd <span class=\"token operator\">=</span> win32gui<span class=\"token punctuation\">.</span>FindWindow<span class=\"token punctuation\">(</span><span class=\"token string\">'Notepad'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hwnd'</span><span class=\"token punctuation\">,</span> hwnd<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> hwnd<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 启动记事本</span>\n        os<span class=\"token punctuation\">.</span>startfile<span class=\"token punctuation\">(</span><span class=\"token string\">'notepad'</span><span class=\"token punctuation\">)</span>\n    app <span class=\"token operator\">=</span> QApplication<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span>\n    w <span class=\"token operator\">=</span> Window<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    w<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>exec_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"效果图\"><a class=\"markdownIt-Anchor\" href=\"#效果图\">#</a> 效果图</h2>\n<p><img src=\"/PyQt/Demo/ScreenShot/FollowWindow.gif\" alt=\"FollowWindow\"></p>\n",
            "tags": [
                "PyQt",
                "窗口"
            ]
        }
    ]
}