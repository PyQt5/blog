{
    "version": "https://jsonfeed.org/version/1",
    "title": "PyQt • All posts by \"model\" tag",
    "description": "Python PyQt PyQt6 PyQt5 PyQt4 PySide PySide2 PySide6",
    "home_page_url": "https://pyqt5.com",
    "items": [
        {
            "id": "https://pyqt5.com/datawidgetmapper_625781186.html",
            "url": "https://pyqt5.com/datawidgetmapper_625781186.html",
            "title": "QDataWidgetMapper 数据库绑定 QLineEdit控件",
            "date_published": "2018-10-29T08:17:59.000Z",
            "content_html": "<p>qt 为操作数据库提供了一个 model+view 的模式，这样简单的出入库逻辑就不需要自己编写。</p>\n<p><code>QDataWidgetMapper</code>  可以 将数据库的数据 映射到其他控件 。</p>\n<p>注意：表格里的数据修改 还没有提交到数据库，需要点击提交按钮才生效。</p>\n<span id=\"more\"></span>\n<p><a href=\"https://github.com/PyQt5/PyQt/tree/master/Test/partner_625781186/16_sqlModel/01_mapper\">https://github.com/PyQt5/PyQt/tree/master/Test/partner_625781186/16_sqlModel/01_mapper</a></p>\n<h2 id=\"代码\"><a class=\"markdownIt-Anchor\" href=\"#代码\">#</a> 代码</h2>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\">#-*- coding: utf-8 -*-</span>\n\n<span class=\"token keyword\">from</span> PyQt5 <span class=\"token keyword\">import</span>  QtWidgets<span class=\"token punctuation\">,</span> QtGui<span class=\"token punctuation\">,</span> QtCore\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtCore <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtGui <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span> PyQt5<span class=\"token punctuation\">.</span>QtSql <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n\n<span class=\"token keyword\">import</span> sys\n\nsys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">'./ui'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">from</span> Ui_MainWindow <span class=\"token keyword\">import</span> Ui_MainWindow\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MainWindow</span><span class=\"token punctuation\">(</span>QMainWindow<span class=\"token punctuation\">,</span> Ui_MainWindow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> parent<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>MainWindow<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span>  <span class=\"token operator\">*</span>args<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>setupUi<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span><span class=\"token number\">800</span><span class=\"token punctuation\">,</span><span class=\"token number\">600</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">#===============================   db   ======================================#</span>\n        <span class=\"token comment\"># self.db = QSqlDatabase.addDatabase('QMYSQL')</span>\n        <span class=\"token comment\"># self.db.setHostName(\"127.0.0.1\")  # set address</span>\n        <span class=\"token comment\"># self.db.setUserName(\"root\")  # set user name</span>\n        <span class=\"token comment\"># self.db.setPassword('123456')  # set user pwd   </span>\n        <span class=\"token comment\"># self.db.setDatabaseName(\"database\")</span>\n        \n        self<span class=\"token punctuation\">.</span>db <span class=\"token operator\">=</span> QSqlDatabase<span class=\"token punctuation\">.</span>addDatabase<span class=\"token punctuation\">(</span><span class=\"token string\">'QSQLITE'</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>db<span class=\"token punctuation\">.</span>setDatabaseName<span class=\"token punctuation\">(</span><span class=\"token string\">'./db/database.db'</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">#================================= codemodel =====================================#</span>\n        <span class=\"token comment\"># 实例化model</span>\n        self<span class=\"token punctuation\">.</span>codeModel <span class=\"token operator\">=</span> QSqlRelationalTableModel<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># model设置表</span>\n        self<span class=\"token punctuation\">.</span>initializeModel<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>codeModel<span class=\"token punctuation\">,</span> <span class=\"token string\">'Mongo'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 设置编辑策略</span>\n        <span class=\"token comment\"># self.codeModel.setEditStrategy(QSqlTableModel.OnFieldChange)</span>\n        <span class=\"token comment\"># !!! 这里要注意 , 只能用这个策略 , 才可以实现自动提交</span>\n        self<span class=\"token punctuation\">.</span>codeModel<span class=\"token punctuation\">.</span>setEditStrategy<span class=\"token punctuation\">(</span>QSqlTableModel<span class=\"token punctuation\">.</span>OnManualSubmit<span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>codeView <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>createView<span class=\"token punctuation\">(</span><span class=\"token string\">\"code_View\"</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>codeModel<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>verticalLayout<span class=\"token punctuation\">.</span>addWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>codeView<span class=\"token punctuation\">)</span>  \n\n        <span class=\"token comment\">#================================ initData ==================================#</span>\n        <span class=\"token comment\"># 数据映射</span>\n        self<span class=\"token punctuation\">.</span>mapper <span class=\"token operator\">=</span> QDataWidgetMapper<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 提交策略</span>\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>setSubmitPolicy<span class=\"token punctuation\">(</span>QDataWidgetMapper<span class=\"token punctuation\">.</span>AutoSubmit<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 映射的模型源</span>\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>setModel<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>codeModel<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>addMapping<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>l1<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>addMapping<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>l2<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>addMapping<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>l3<span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>addMapping<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>l4<span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>addMapping<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>l5<span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>toFirst<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">#================================ pushButton ==================================#</span>\n        self<span class=\"token punctuation\">.</span>sub_btn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>submit<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>sub_btn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>codeModel<span class=\"token punctuation\">.</span>submitAll<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>pre_btn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>toPrevious<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>next_btn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>toNext<span class=\"token punctuation\">)</span>\n        \n    <span class=\"token keyword\">def</span> <span class=\"token function\">initializeModel</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> tablename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">'''重关联。'''</span>\n        model<span class=\"token punctuation\">.</span>setTable<span class=\"token punctuation\">(</span>tablename<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#        model.setEditStrategy(QSqlTableModel.OnRowChange)</span>\n        model<span class=\"token punctuation\">.</span>select<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n    <span class=\"token keyword\">def</span> <span class=\"token function\">createView</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">'''创建TableView视图'''</span>\n        view <span class=\"token operator\">=</span>  QTableView<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        view<span class=\"token punctuation\">.</span>setModel<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span>\n        view<span class=\"token punctuation\">.</span>setWindowTitle<span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#列宽设置</span>\n        view<span class=\"token punctuation\">.</span>horizontalHeader<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setSectionResizeMode<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#行高设置</span>\n        view<span class=\"token punctuation\">.</span>verticalHeader<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setSectionResizeMode<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#充满列宽</span>\n        view<span class=\"token punctuation\">.</span>horizontalHeader<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setStretchLastSection<span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> \n<span class=\"token comment\">#        view.verticalHeader().setVisible(False)#隐藏行标题</span>\n        <span class=\"token comment\">#标题左对齐</span>\n        view<span class=\"token punctuation\">.</span>horizontalHeader<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setDefaultAlignment<span class=\"token punctuation\">(</span>Qt<span class=\"token punctuation\">.</span>AlignLeft<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#标题左对齐</span>\n        view<span class=\"token punctuation\">.</span>verticalHeader<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setDefaultAlignment<span class=\"token punctuation\">(</span>Qt<span class=\"token punctuation\">.</span>AlignLeft<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">return</span> view  \n    \n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">import</span> sys\n    \n    app <span class=\"token operator\">=</span> QApplication<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span>\n    app<span class=\"token punctuation\">.</span>setStyle<span class=\"token punctuation\">(</span>QStyleFactory<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span><span class=\"token string\">\"Fusion\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    ui <span class=\"token operator\">=</span> MainWindow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    ui<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>exec_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"效果图\"><a class=\"markdownIt-Anchor\" href=\"#效果图\">#</a> 效果图</h2>\n<p><img src=\"/images/datawidgetmapper.gif\" alt=\"datawidgetmapper\"></p>\n",
            "tags": [
                "PyQt",
                "Model"
            ]
        }
    ]
}